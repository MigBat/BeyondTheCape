namespace = btc_events
normal_or_historical_nations = yes

# Quest for the New World #

country_event = {
	id = btc_events.1
	title = btc_events.1_t
	desc = btc_events.1_d
	picture = EXPLORERS_eventPicture

	trigger = {
		NOT = { has_country_flag = quest_for_the_new_world }
		NOT = { has_country_modifier = quest_for_the_new_world }
		has_idea_group = exploration_ideas
		dip_tech = 9
	}

	option = {
		name = btc_events.1a

		add_country_modifier = {
			name = quest_for_the_new_world	# may hire explorers, conquistadors and discover ocean tiles
			duration = -1
		}
		set_country_flag = quest_for_the_new_world
	}
}

# Morocco defend against Iberians #

country_event = {
	id = btc_events.2
	title = btc_events.2_t
	desc = btc_events.2_d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes

	option = {
		name = btc_events.2a

		every_owned_province = {
			add_permanent_province_modifier = {
				name = resist_reconquista
				duration = 36500
			}
		}
		set_country_flag = resisting_reconquista
	}
}

# Granada defend against Castile #

# country_event = {
# 	id = btc_events.3
# 	title = btc_events.3_t
# 	desc = btc_events.3_d
# 	picture = RELIGIOUS_WARS_eventPicture

# 	fire_only_once = yes

# 	trigger = {
# 		tag = GRA
# 	}

# 	option = {
# 		name = btc_events.3a

# 		upper_andalucia_area = {
# 			add_province_modifier = {
# 				name = resist_reconquista
# 				duration = 10950
# 			}
# 		}
# 	}
# }

# Galician Nobles rule the region #

country_event = {
	id = btc_events.4
	title = btc_events.4_t
	desc = btc_events.4_d
	picture = CORRUPTION_eventPicture

	fire_only_once = yes

	trigger = {
		tag = CAS
	}

	option = {
		name = btc_events.4a

		galicia_area = {
			add_province_modifier = {
				name = strong_nobility
				duration = -1
			}
		}
	}
}

# Monthly OPM Diplo Calculation #

country_event = {
	id = btc_events.5
	title = btc_events.5_t
	desc = btc_events.5_d

	is_triggered_only = yes
	hidden = yes

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = btc_events.5a

		trigger = {
			AND = {
				num_of_cities = 1
				NOT = { num_of_cities = 2 }
			}
		}

		if = {
			limit = {
				NOT = {
					has_country_modifier = opm_diplomacy
				}
			}
			add_country_modifier = {
				name = opm_diplomacy
				duration = -1
			}
		}
	}

	option = {
		name = btc_events.5b

		trigger = {
			num_of_cities = 2
		}

		if = {
			limit = {
				has_country_modifier = opm_diplomacy
			}
			remove_country_modifier = opm_diplomacy
		}
	}
}

# Remove dev with high devastation

province_event = {
	id = btc_events.6
	title = btc_events.6_t
	desc = btc_events.6_d

	hidden = yes
	
	trigger = {
		devastation = 10
		NOT = { has_province_modifier = dev_decreased_recently }
		development = 4
	}

	mean_time_to_happen = {
		months = 24
		modifier = {
			factor = 0.5
			devastation = 20
		}
		modifier = {
			factor = 0.5
			devastation = 30
		}
		modifier = {
			factor = 0.5
			devastation = 40
		}
		modifier = {
			factor = 0.5
			devastation = 50
		}
	}

	option = {
		name = btc_events.6a

		random_list = {
			33 = { add_base_tax = -1 }
			33 = { add_base_production = -1 }
			33 = { add_base_manpower = -1 }
		}
		add_province_modifier = {
			name = dev_decreased_recently
			duration = 730
		}
	}
}

# The Portuguese Have Grown Too Powerful #

country_event = {
	id = btc_events.7
	title = btc_events.7_t
	desc = btc_events.7_d
	picture = SAD_MERCHANT_eventPicture

	fire_only_once = yes

	trigger = {
		tag = MAM
		has_country_flag = MAM_POR_conflict

		OR = {
			exists = POR
			exists = IBE
		}
		owns = 2315
		4346 = {				#Gulf of Aden
			OR = {
				is_strongest_trade_power = POR
				is_strongest_trade_power = IBE
			}
		}
	}
	
	mean_time_to_happen = {
		months = 3
	}
	
	option = {
		name = btc_events.7a
		ai_chance = { factor = 90 }

		if = {
			limit = {
				exists = POR
			}
			declare_war_with_cb = {
				casus_belli = cb_trade_war_triggered
				who = POR
			}	
		}
		else = {
			declare_war_with_cb = {
				casus_belli = cb_trade_war_triggered
				who = IBE
			}
		}			
	}

	option = {
		name = btc_events.7b
		add_prestige = -25
		4346 = {
			add_trade_modifier = {
				who = root
				duration = 3650
				power = -5
				key = surrender_the_trade
			}
		}
	}
}

# Lourenço de Almeida #

country_event = {
	id = btc_events.8
	title = btc_events.8_t
	desc = btc_events.8_d
	picture = BANKRUPTCY_eventPicture

	is_triggered_only = yes

	option = {	# Send a letter apologising
		name = btc_events.8a

		ai_chance = {
			factor = 90
		}

		add_prestige = 10

		set_country_flag = killed_lourenco

		if = {
			limit = {
				exists = POR
			}
			POR = {
				country_event = {
					id = btc_events.9
					days = 1
				}
			}
		}
		else = {
			IBE = {
				country_event = {
					id = btc_events.9
					days = 1
				}
			}
		}
		
	}

	option = {	# He got no less than what he deserved
		name = btc_events.8b

		ai_chance = {
			factor = 10
		}
		
		add_legitimacy = 10

		set_country_flag = killed_lourenco

		if = {
			limit = {
				exists = POR
			}
			POR = {
				country_event = {
					id = btc_events.9
					days = 1
				}
			}
		}
		else = {
			IBE = {
				country_event = {
					id = btc_events.9
					days = 1
				}
			}
		}
	}
}

# A Son's Blood #

country_event = {
	id = btc_events.9
	title = btc_events.9_t
	desc = btc_events.9_d
	picture = NAVAL_MILITARY_eventPicture

	is_triggered_only = yes

	option = {	# Send Albuquerque to retrieve him at once
		name = btc_events.9a

		ai_chance = {
			factor = 90
		}

		custom_tooltip = get_francisco_tt

		set_country_flag = get_francisco
	}

	option = {	# Send Albuquerque to assist him
		name = btc_events.9b

		ai_chance = {
			factor = 10
		}

		custom_tooltip = keep_francisco_tt

		set_country_flag = keep_francisco
		add_legitimacy = -20
	}
}

# Battle of Diu #

country_event = {
	id = btc_events.10
	title = btc_events.10_t
	desc = btc_events.10_d
	picture = FLAGSHIP_SUNK_eventPicture

	is_triggered_only = yes

	option = {
		name = btc_events.10a

		trigger = {
			has_country_flag = get_francisco
		}

		set_country_flag = battle_of_diu

		define_conquistador = {
			name = "Afonso de Albuquerque"
			fire = 5
			shock = 5
			manuever = 4
			siege = 2
			trait = master_of_arms_personality
		}
		kill_leader = { type = "Francisco de Almeida" }

		4346 = {
			remove_trade_modifier = {
				who = root
				key = portuguese_privateers
			}
			add_trade_modifier = {
				who = root
				duration = -1
				power = 25
				key = spice_trade_monopoly
			}		
		}
		1334 = {
			add_trade_modifier = {
				who = root
				duration = -1
				power = 25
				key = spice_trade_monopoly
			}		
		}
		1340 = {
			add_trade_modifier = {
				who = root
				duration = -1
				power = 25
				key = spice_trade_monopoly
			}			
		}
		504 = {
			add_trade_modifier = {
				who = root
				duration = -1
				power = 25
				key = spice_trade_monopoly
			}			
		}
	}

	option = {
		name = btc_events.10b

		trigger = {
			has_country_flag = keep_francisco
		}

		set_country_flag = battle_of_diu

		define_conquistador = {
			name = "Afonso de Albuquerque"
			fire = 5
			shock = 5
			manuever = 4
			siege = 2
			trait = master_of_arms_personality
		}

		4346 = {
			remove_trade_modifier = {
				who = root
				key = portuguese_privateers
			}
			add_trade_modifier = {
				who = root
				duration = -1
				power = 25
				key = spice_trade_monopoly
			}		
		}
		1334 = {
			add_trade_modifier = {
				who = root
				duration = -1
				power = 25
				key = spice_trade_monopoly
			}			
		}
		1340 = {
			add_trade_modifier = {
				who = root
				duration = -1
				power = 25
				key = spice_trade_monopoly
			}		
		}
		504 = {
			add_trade_modifier = {
				who = root
				duration = -1
				power = 25
				key = spice_trade_monopoly
			}		
		}
	}
}

# We've Won the War of the Three Kings #

country_event = {
	id = btc_events.11
	title = btc_events.11_t
	desc = btc_events.11_d
	picture = RELIGIOUS_WARS_eventPicture

	is_triggered_only = yes
	major = yes

	option = {
		name = btc_events.11a

		POR = { clr_country_flag = war_of_three_kings }
		IBE = { clr_country_flag = war_of_three_kings }
		MOR = { clr_country_flag = war_of_three_kings }

		remove_rival = MOR

		MOR = {
			define_ruler = {
				name = "Abu Abdallah"
				age = 35
				dynasty = Saadi
				adm = 2
				dip = 4
				mil = 4
			}
			kill_heir = {}
			if = {
				limit = {
					exists = POR
				}
				create_alliance = POR
				add_opinion = {
					who = POR
					modifier = war_of_three_kings
				}
				remove_rival = POR
			}
			else = {
				create_alliance = IBE
				add_opinion = {
					who = IBE
					modifier = war_of_three_kings
				}
				remove_rival = IBE
			}
			capital_scope = {
				change_religion = catholic	
				set_province_flag = is_catholic					
			}
			every_owned_province = {
				random_province_in_state = {
					limit = {
						NOT = { has_province_flag = is_catholic }	
						NOT = { religion = catholic }
					}
					change_religion = catholic	
					set_province_flag = is_catholic		
				}
				random_province_in_state = {
					limit = {
						NOT = { has_province_flag = is_catholic }		
						NOT = { religion = catholic }
					}
					change_religion = catholic	
					set_province_flag = is_catholic		
				}
				random_province_in_state = {
					limit = {
						NOT = { has_province_flag = is_catholic }		
						NOT = { religion = catholic }
					}
					change_religion = catholic	
					set_province_flag = is_catholic		
				}
				random_province_in_state = {
					limit = {
						NOT = { has_province_flag = is_catholic }		
						NOT = { religion = catholic }
					}
					change_religion = catholic	
					set_province_flag = is_catholic		
				}
				random_province_in_state = {
					limit = {
						NOT = { has_province_flag = is_catholic }		
						NOT = { religion = catholic }
					}
					change_religion = catholic	
					set_province_flag = is_catholic		
				}
			}
		}
	}
}

# Battle of Alcácer Quibir #

country_event = {
	id = btc_events.12
	title = btc_events.12_t
	desc = btc_events.12_d
	picture = WOUNDED_SOLDIERS_eventPicture

	is_triggered_only = yes

	option = {
		name = btc_events.12a

		POR = { clr_country_flag = war_of_three_kings }
		MOR = { clr_country_flag = war_of_three_kings }

		kill_ruler = yes
		white_peace = MOR
		add_stability = -2
		add_country_modifier = {
			name = portugal_succession_crisis
			duration = 1825
		}
	}
}

# The Portuguese Succession #

country_event = {
	id = btc_events.13
	title = btc_events.13_t
	desc = btc_events.13_d
	picture = DISCIPLINED_SOLDIERS_eventPicture

	trigger = {
		OR = {
			tag = CAS
			tag = SPA
		}
		POR = {
			has_country_modifier = portugal_succession_crisis
		}
	}

	mean_time_to_happen = {
		days = 60
	}

	option = {	# Seize this opportunity
		name = btc_events.13a

		declare_war_with_cb = {
			casus_belli = cb_restore_personal_union
			who = POR
		}
	}

	option = {	# We will bide our time
		name = btc_events.13b

		add_casus_belli = {
			type = cb_restore_personal_union
			target = POR
			months = 60
		}
	}
}

# Increase dev with high prosperity

province_event = {
	id = btc_events.15
	title = btc_events.15_t
	desc = btc_events.15_d

	hidden = yes
	
	trigger = {
		is_prosperous = yes
		NOT = { has_province_modifier = dev_increased_recently }
	}

	mean_time_to_happen = {
		months = 12
	}

	option = {
		name = btc_events.15a

		random_list = {
			33 = { add_base_tax = 1 }
			33 = { add_base_production = 1 }
			33 = { add_base_manpower = 1 }
		}
		add_province_modifier = {
			name = dev_increased_recently
			duration = 730
		}
	}
}

# Settler Pool Calculations #

country_event = {
	id = btc_events.14
	title = btc_events.14_t
	desc = btc_events.14_d

	hidden = yes

	is_triggered_only = yes

	immediate = {

		export_to_variable = {
			which = numProvincesInStates
			value = trigger_value:num_of_provinces_in_states
		}
		multiply_variable = {
			which = numProvincesInStates	# provinces in states * 30
			value = 30
		}
		export_to_variable = {
			which = totalDevelopment
			value = trigger_value:total_development
		}
		multiply_variable = {
			which = totalDevelopment	# total development * 2
			value = 2
		}
		change_variable = {
			which = numProvincesInStates
			which = totalDevelopment
		}
		change_variable = {
			which = numProvincesInStates
			value = 1000				# base value
		}
		# Decision add 1000 settlers
		if = {
			limit = {
				has_country_flag = decisionAddSettlers_flag
			}
			change_variable = {
				which = numProvincesInStates
				value = 1000
			}
		}
		if = {
			limit = {
				had_country_flag = {
					flag = decisionAddSettlers_flag
					days = 1825
				}
			}
			clr_country_flag = decisionAddSettlers_flag
		}
		# Slaver privilege
		if = {
			limit = {
				has_country_flag = slaverSettlerPool_flag
			}
			change_variable = {
				which = numProvincesInStates
				value = 1000
			}
		}

		set_variable = {
			which = maxNumOfSettlers	# maximum number of settlers of a country
			which = numProvincesInStates
		}

		export_to_variable = {
			which = numOfColonies	# current number of colonies
			value = trigger_value:num_of_colonies
		}
		set_variable = {
			which = usedSettlers
			which = numOfColonies
		}
		multiply_variable = {
			which = usedSettlers	# settlers currently colonizing
			value = 1000
		}

		set_variable = {
			which = proxyMaxNumOfSettlers
			which = maxNumOfSettlers
		}
		subtract_variable = {
			which = proxyMaxNumOfSettlers
			which = usedSettlers
		}
		set_variable = {
			which = freeSettlers	# currently available settlers
			which = proxyMaxNumOfSettlers
		}
	}

	option = {
		name = btc_events.14a

		set_variable = {
			which = 0settlers	# 0% of max settlers
			value = 0			
		}
		change_variable = {
			which = 0settlers
			value = 1
		}

		set_variable = {
			which = 25settlers
			which = maxNumOfSettlers
		}
		multiply_variable = {
			which = 25settlers	# 25% of max settlers
			value = 0.25
		}

		set_variable = {
			which = 50settlers
			which = maxNumOfSettlers
		}
		multiply_variable = {
			which = 50settlers	# 50% of max settlers
			value = 0.50
		}

		set_variable = {
			which = 75settlers
			which = maxNumOfSettlers
		}
		multiply_variable = {
			which = 75settlers	# 75% of max settlers
			value = 0.75
		}

		if = {
			limit = {
				NOT = {
					check_variable = {
						which = freeSettlers
						which = 0settlers
					}
				}
			}
			add_country_modifier = {
				name = no_settlers
				duration = -1
			}
			remove_country_modifier = very_low_settlers
			remove_country_modifier = low_settlers
			remove_country_modifier = some_settlers
			remove_country_modifier = many_settlers
		}
		if = {
			limit = {
				check_variable = {
					which = freeSettlers
					which = 0settlers
				}
				NOT = {
					check_variable = {
						which = freeSettlers
						which = 25settlers
					}
				}
			}
			add_country_modifier = {
				name = very_low_settlers
				duration = -1
			}
			remove_country_modifier = no_settlers
			remove_country_modifier = low_settlers
			remove_country_modifier = some_settlers
			remove_country_modifier = many_settlers
		}
		if = {
			limit = {
				AND = {
					check_variable = {
						which = freeSettlers
						which = 25settlers
					}
					NOT = {
						check_variable = {
							which = freeSettlers
							which = 50settlers
						}
					}
				}
			}
			add_country_modifier = {
				name = low_settlers
				duration = -1
			}
			remove_country_modifier = no_settlers
			remove_country_modifier = very_low_settlers
			remove_country_modifier = some_settlers
			remove_country_modifier = many_settlers
		}
		if = {
			limit = {
				AND = {
					check_variable = {
						which = freeSettlers
						which = 50settlers
					}
					NOT = {
						check_variable = {
							which = freeSettlers
							which = 75settlers
						}
					}
				}
			}
			add_country_modifier = {
				name = some_settlers
				duration = -1
			}
			remove_country_modifier = no_settlers
			remove_country_modifier = very_low_settlers
			remove_country_modifier = low_settlers
			remove_country_modifier = many_settlers
		}
		if = {
			limit = {
				check_variable = {
					which = freeSettlers
					which = 75settlers
				}
			}
			add_country_modifier = {
				name = many_settlers
				duration = -1
			}
			remove_country_modifier = no_settlers
			remove_country_modifier = very_low_settlers
			remove_country_modifier = low_settlers
			remove_country_modifier = some_settlers
		}
	}
}

country_event = {
	id = btc_events.16
	title = btc_events.16_t
	desc = btc_events.16_d
	picture = tutorial_picture

	is_triggered_only = yes

	option = {
		name = btc_events.16a

		trigger = {
			NOT = { has_country_flag = decisionAddSettlers_flag }
		}

		add_years_of_income = -0.25
		custom_tooltip = add_settlers_tt
		hidden_effect = {
			set_country_flag = decisionAddSettlers_flag
		}
	}

	option = {
		name = btc_events.16b
	}
}